<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hybrid 2D/3D Login</title>
    <!-- 1. Tailwind CSS --><script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Using Inter font, loaded by Tailwind */
        body {
            font-family: 'Inter', sans-serif;
            overflow: hidden; /* Prevents scrolling */
        }
        
        #canvas-container {
            /* This will hold both the 3D canvas and the 2D models */
            position: relative;
        }

        /* 3D canvas will fade in and out */
        #main-canvas {
            display: block;
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            z-index: 1; /* Below 2D models by default */
        }

        /* Container for 2D models */
        .model-2d-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 1;
            transition: opacity 0.5s ease-in-out;
            z-index: 2; /* Above 3D canvas */
        }
        .model-2d-container.hidden {
            opacity: 0;
            pointer-events: none;
        }


        /* --- 2D Mobile Phone Styles --- */
        #mobile-2d {
            width: 180px;
            height: 360px;
            background-color: #2d3748; /* gray-800 */
            border-radius: 24px;
            border: 4px solid #4a5568; /* gray-700 */
            position: relative;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        #mobile-2d .screen {
            width: 160px;
            height: 340px;
            background-color: #000;
            position: absolute;
            top: 10px;
            left: 10px;
            border-radius: 16px;
            overflow: hidden;
        }
        #mobile-2d .face {
            position: absolute;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 50px;
        }

        /* --- 2D Clock Styles --- */
        #clock-2d {
            width: 250px;
            height: 250px;
            background-color: #f7fafc; /* gray-100 */
            border-radius: 50%;
            border: 8px solid #a0aec0; /* gray-500 */
            position: relative;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        
        /* --- Clock numerals --- */
        #clock-2d .numeral {
            position: absolute;
            width: 100%;
            height: 100%;
            text-align: center;
            top: 0;
            left: 0;
            font-size: 0.875rem; /* 14px */
            font-weight: 600;
            color: #4a5568; /* gray-700 */
        }
        #clock-2d .numeral span {
            display: inline-block;
            padding-top: 12px; /* Distance from center */
        }
        #clock-2d .numeral.n1 { transform: rotate(30deg); }
        #clock-2d .numeral.n1 span { transform: rotate(-30deg); }
        #clock-2d .numeral.n2 { transform: rotate(60deg); }
        #clock-2d .numeral.n2 span { transform: rotate(-60deg); }
        #clock-2d .numeral.n3 { transform: rotate(90deg); }
        #clock-2d .numeral.n3 span { transform: rotate(-90deg); }
        #clock-2d .numeral.n4 { transform: rotate(120deg); }
        #clock-2d .numeral.n4 span { transform: rotate(-120deg); }
        #clock-2d .numeral.n5 { transform: rotate(150deg); }
        #clock-2d .numeral.n5 span { transform: rotate(-150deg); }
        #clock-2d .numeral.n6 { transform: rotate(180deg); }
        #clock-2d .numeral.n6 span { transform: rotate(-180deg); }
        #clock-2d .numeral.n7 { transform: rotate(210deg); }
        #clock-2d .numeral.n7 span { transform: rotate(-210deg); }
        #clock-2d .numeral.n8 { transform: rotate(240deg); }
        #clock-2d .numeral.n8 span { transform: rotate(-240deg); }
        #clock-2d .numeral.n9 { transform: rotate(270deg); }
        #clock-2d .numeral.n9 span { transform: rotate(-270deg); }
        #clock-2d .numeral.n10 { transform: rotate(300deg); }
        #clock-2d .numeral.n10 span { transform: rotate(-300deg); }
        #clock-2d .numeral.n11 { transform: rotate(330deg); }
        #clock-2d .numeral.n11 span { transform: rotate(-330deg); }
        #clock-2d .numeral.n12 { transform: rotate(0deg); }
        #clock-2d .numeral.n12 span { transform: rotate(0deg); }
        
        #clock-2d .face {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 150px;
            height: 70px;
            z-index: 11; /* Above hands */
        }
        #clock-2d .hand {
            position: absolute;
            bottom: 50%;
            left: 50%;
            transform-origin: bottom center;
            background-color: #1a202c; /* gray-900 */
            border-radius: 2px;
            z-index: 5;
        }
        #clock-2d .hour-hand {
            width: 6px;
            height: 60px;
            margin-left: -3px;
        }
        #clock-2d .minute-hand {
            width: 4px;
            height: 90px;
            margin-left: -2px;
        }
        #clock-2d .second-hand {
            width: 2px;
            height: 100px;
            margin-left: -1px;
            background-color: #e53e3e; /* red-600 */
            z-index: 6;
        }
        #clock-2d .center-pin {
            width: 10px;
            height: 10px;
            background-color: #1a202c;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
        }

        /* --- Shared Face Styles --- */
        .eye-container {
            width: 100%;
            display: flex;
            justify-content: space-around;
        }
        .eye {
            width: 40px;
            height: 40px;
            background-color: #fff;
            border-radius: 50%;
            position: relative;
            overflow: hidden;
            border: 2px solid #000;
            transition: height 0.2s ease-in-out;
        }
        .peeking .eye {
            height: 4px; /* Squint/close eyes */
            border-radius: 2px;
        }
        .pupil {
            width: 18px;
            height: 18px;
            background-color: #000;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            transition: transform 0.1s linear;
        }
        .mouth-container {
            width: 100%;
            display: flex;
            justify-content: center;
            margin-top: 15px;
        }
        .mouth {
            width: 40px;
            height: 20px;
            border-radius: 0 0 20px 20px;
            background-color: #000;
            transition: all 0.2s ease-in-out;
        }
        .peeking .mouth {
            width: 30px;
            height: 4px;
            border-radius: 2px;
        }

        /* --- Form Styles --- */
        .divider {
            display: flex;
            align-items: center;
            text-align: center;
            color: #9ca3af; /* gray-400 */
            margin: 1.5rem 0; /* my-6 */
        }
        .divider::before,
        .divider::after {
            content: '';
            flex: 1;
            border-bottom: 1px solid #4a5568; /* gray-700 */
        }
        .divider:not(:empty)::before { margin-right: .5em; }
        .divider:not(:empty)::after { margin-left: .5em; }
        .google-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            padding: 0.75rem; /* p-3 */
            background-color: #fff;
            color: #1f2937; /* gray-800 */
            border-radius: 0.5rem; /* rounded-lg */
            font-weight: 500; /* medium */
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            transition: background-color 0.3s;
        }
        .google-btn:hover { background-color: #f3f4f6; /* gray-100 */ }
        .google-btn svg {
            width: 1.25rem; /* w-5 */
            height: 1.25rem; /* h-5 */
            margin-right: 0.75rem; /* mr-3 */
        }
        .form-alert {
            padding: 0.75rem 1rem;
            margin-bottom: 1rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            display: none; /* Hidden by default */
        }
        .form-alert-info {
            background-color: #3182ce; /* blue-600 */
            color: white;
        }
        .form-input-label.required::after {
            content: '*';
            color: #ef4444; /* Tailwind red-500 */
            margin-left: 0.25rem; /* Space between text and asterisk */
        }
        
        /* New style for form transition */
        .form-state {
            display: none;
            transition: opacity 0.5s ease-in-out;
        }
        .form-state.active {
            display: block;
        }
    </style>
</head>
<body class="bg-gray-900 text-white">

    <!-- Main container: splits screen 50/50 --><div class="flex h-screen w-screen relative">

        <!-- LEFT SIDE: Animation Container --><div id="canvas-container" class="w-full h-full lg:w-1/2 relative z-0">
            <!-- 3D Canvas (hidden by default) -->
            <canvas id="main-canvas"></canvas>
            
            <!-- 2D Mobile Phone (Visible by default) -->
            <div id="mobile-2d-container" class="model-2d-container">
                <div id="mobile-2d">
                    <div class="screen">
                        <div class="face">
                            <div class="eye-container">
                                <div class="eye"><div class="pupil" data-pupil="true"></div></div>
                                <div class="eye"><div class="pupil" data-pupil="true"></div></div>
                            </div>
                            <div class="mouth-container">
                                <div class="mouth"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 2D Clock (hidden by default) -->
            <div id="clock-2d-container" class="model-2d-container hidden">
                <div id="clock-2d">
                    <!-- Numerals -->
                    <div class="numeral n1"><span>1</span></div>
                    <div class="numeral n2"><span>2</span></div>
                    <div class="numeral n3"><span>3</span></div>
                    <div class="numeral n4"><span>4</span></div>
                    <div class="numeral n5"><span>5</span></div>
                    <div class="numeral n6"><span>6</span></div>
                    <div class="numeral n7"><span>7</span></div>
                    <div class="numeral n8"><span>8</span></div>
                    <div class="numeral n9"><span>9</span></div>
                    <div class="numeral n10"><span>10</span></div>
                    <div class="numeral n11"><span>11</span></div>
                    <div class="numeral n12"><span>12</span></div>
                    <!-- End Numerals -->
                    
                    <div class="center-pin"></div>
                    <div id="hour-hand" class="hand hour-hand"></div>
                    <div id="minute-hand" class="hand minute-hand"></div>
                    <div id="second-hand" class="hand second-hand"></div>
                    <div class="face">
                        <div class="eye-container">
                            <div class="eye"><div class="pupil" data-pupil="true"></div></div>
                            <div class="eye"><div class="pupil" data-pupil="true"></div></div>
                        </div>
                        <div class="mouth-container">
                            <div class="mouth"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Loading overlay for 3D -->
            <div id="loading-overlay" class="absolute inset-0 flex items-center justify-center bg-gray-900 z-10 text-xl font-semibold hidden">
                Loading 3D Assets...
            </div>
        </div>

        <!-- RIGHT SIDE: Login/Register Form --><div id="form-panel" class="w-full h-full lg:w-1/2 flex items-center justify-center p-8 absolute lg:relative top-0 left-0 bg-gray-900 bg-opacity-80 lg:bg-opacity-100 z-10">
            <div class="w-full max-w-md">

                <!-- Alert Message Area -->
                <div id="form-alert-message" class="form-alert form-alert-info"></div>

                <!-- Login Form (Visible by default) -->
                <div id="login-form" data-form-state="login" class="form-state active transition-colors duration-1000">
                    <h2 class="text-3xl font-bold mb-6 text-center text-white">Welcome Back!</h2>
                    
                    <div class="mb-4">
                        <label for="login-email" class="form-input-label required block text-sm font-medium text-gray-300 mb-2">Email or Username</label>
                        <input type="email" id="login-email" class="form-input w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors duration-500">
                    </div>
                    
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-2">
                            <label for="login-password" class="form-input-label required block text-sm font-medium text-gray-300">Password</label>
                            <a href="#" id="forgot-password-link" class="text-sm font-medium text-blue-400 hover:text-blue-300">Forgot Password?</a>
                        </div>
                        <div class="relative">
                            <input type="password" id="login-password" class="form-input w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors duration-500">
                            <button class="absolute inset-y-0 right-0 px-4 text-gray-400 hover:text-white" onclick="togglePasswordVisibility(this)">
                                <!-- Eye Icon --><svg class="h-6 w-6 eye-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                                </svg>
                                <!-- Eye-Off Icon (hidden by default) --><svg class="h-6 w-6 eye-off-icon hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M3.98 8.223A10.477 10.477 0 0 0 1.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.451 10.451 0 0 1 12 4.5c4.756 0 8.773 3.162 10.065 7.498a10.522 10.522 0 0 1-4.293 5.575M9 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 19.5 4.5 4.5" />
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <button id="login-button" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition-all duration-300 mb-6">
                        Login
                    </button>

                    <div class="divider">Or</div>

                    <button id="login-google-btn" class="google-btn">
                        <svg viewBox="0 0 48 48"><path fill="#FFC107" d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24c0,11.045,8.955,20,20,20c11.045,0,20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"></path><path fill="#FF3D00" d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"></path><path fill="#4CAF50" d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z"></path><path fill="#1976D2" d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.574l6.19,5.238C39.712,35.619,44,29.891,44,24C44,22.659,43.862,21.35,43.611,20.083z"></path></svg>
                        Sign in with Google
                    </button>
                    
                    <p class="mt-6 text-center text-gray-400">
                        Need an account? 
                        <span id="show-register" class="font-medium text-blue-400 hover:text-blue-300 cursor-pointer transition-colors duration-500">
                            Register
                        </span>
                    </p>
                </div>

                <!-- Register Form (Hidden by default) -->
                <div id="register-form" data-form-state="register" class="form-state transition-colors duration-1000">
                    <h2 class="text-3xl font-bold mb-6 text-center text-white">Create Account</h2>
                    
                    <div class="mb-4">
                        <label for="reg-username" class="form-input-label required block text-sm font-medium text-gray-300 mb-2">Username</label>
                        <input type="text" id="reg-username" class="form-input w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors duration-500">
                    </div>

                    <div class="mb-4">
                        <label for="reg-email" class="form-input-label required block text-sm font-medium text-gray-300 mb-2">Email</label>
                        <input type="email" id="reg-email" class="form-input w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors duration-500">
                    </div>
                    
                    <div class="mb-4">
                        <label for="reg-password" class="form-input-label required block text-sm font-medium text-gray-300 mb-2">Password</label>
                        <div class="relative">
                            <input type="password" id="reg-password" class="form-input w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors duration-500">
                            <button class="absolute inset-y-0 right-0 px-4 text-gray-400 hover:text-white" onclick="togglePasswordVisibility(this)">
                                <!-- Eye Icon --><svg class="h-6 w-6 eye-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                                </svg>
                                <!-- Eye-Off Icon (hidden by default) --><svg class="h-6 w-6 eye-off-icon hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M3.98 8.223A10.477 10.477 0 0 0 1.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.451 10.451 0 0 1 12 4.5c4.756 0 8.773 3.162 10.065 7.498a10.522 10.522 0 0 1-4.293 5.575M9 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 19.5 4.5 4.5" />
                                </svg>
                            </button>
                        </div>
                    </div>

                    <!-- Confirm Password (hidden by default) -->
                    <div id="reg-password-confirm-wrapper" class="mb-4 hidden">
                        <label for="reg-password-confirm" class="block text-sm font-medium text-gray-300 mb-2">Confirm Password</label>
                        <div class="relative">
                            <input type="password" id="reg-password-confirm" class="form-input w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors duration-500">
                        </div>
                    </div>
                    
                    <!-- Error Message -->
                    <p id="reg-error-message" class="text-red-400 text-sm mb-4 hidden"></p>

                    <button id="register-button" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition-all duration-300 mb-6">
                        Create Account
                    </button>

                    <div class="divider">Or</div>

                    <button id="register-google-btn" class="google-btn">
                        <svg viewBox="0 0 48 48"><path fill="#FFC107" d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24c0,11.045,8.955,20,20,20c11.045,0,20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"></path><path fill="#FF3D00" d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"></path><path fill="#4CAF50" d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z"></path><path fill="#1976D2" d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.574l6.19,5.238C39.712,35.619,44,29.891,44,24C44,22.659,43.862,21.35,43.611,20.083z"></path></svg>
                        Sign up with Google
                    </button>
                    
                    <p class="mt-6 text-center text-gray-400">
                        Already have an account? 
                        <span id="show-login-from-reg" class="font-medium text-blue-400 hover:text-blue-300 cursor-pointer transition-colors duration-500">
                            Login
                        </span>
                    </p>
                </div>
                
                <!-- NEW: Forgot Password Form (Hidden by default) -->
                <div id="forgot-form" data-form-state="forgot" class="form-state transition-colors duration-1000">
                    <h2 class="text-3xl font-bold mb-4 text-center text-white">Reset Password</h2>
                    <p class="text-gray-400 text-center mb-6">Enter your Register email and we'll send you a link to get back into your account.</p>

                    <div class="mb-6">
                        <label for="forgot-email" class="form-input-label required block text-sm font-medium text-gray-300 mb-2">Email</label>
                        <input type="email" id="forgot-email" placeholder="you@example.com" class="form-input w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors duration-500">
                    </div>
                    
                    <button id="send-reset-link" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition-all duration-300 mb-6">
                        Send Reset Link
                    </button>

                    <p class="mt-6 text-center">
                        <span id="show-login-from-forgot" class="font-medium text-blue-400 hover:text-blue-300 cursor-pointer transition-colors duration-500 flex items-center justify-center">
                            <!-- Arrow Left Icon --><svg class="w-4 h-4 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18" />
                            </svg>
                            Back to Login
                        </span>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- 3D Globe Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>


    <!-- Main Application Logic --><script type="module">
        // --- 3D Imports ---
        const { OrbitControls } = THREE;

        // --- Firebase Imports ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, 
            signInWithPopup, 
            GoogleAuthProvider, 
            signInWithCustomToken, 
            signInAnonymously,
            onAuthStateChanged
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        // --- Global 3D State ---
        let scene, camera, renderer, controls;
        let globe;
        let transitionState = 'idle'; // 'idle', 'zoomOutToGlobe', 'zoomInToClock', 'zoomOutFromClock', 'zoomInToPhone'
        
        // --- Animation Targets ---
        const GLOBE_RADIUS = 10;
        const newYorkCoords = { lat: 40.7128, lon: -74.0060 }; // New York for clock
        const globeOriginCoords = { lat: 0, lon: 0 }; // Starting point
        
        let clockPositionOnGlobe, phonePositionOnGlobe;
        let phoneTargetQuaternion, clockTargetQuaternion; // Quaternions to rotate globe
        
        // Camera positions
        const wideGlobeCamPos = new THREE.Vector3(0, 0, 30);
        const globeCenter = new THREE.Vector3(0, 0, 0);
        let phoneCamPos, phoneCamTarget; // Calculated
        let clockCamPos, clockCamTarget; // Calculated

        // --- Global UI State ---
        let currentScene = 'login'; // 'login', 'register', or 'forgot'
        const mouse = new THREE.Vector2();
        const mousePixel = new THREE.Vector2(); // Add this for 2D pixel tracking
        let isWatchingInput = false;
        let isPeekingPassword = false;

        // --- DOM Elements ---
        const canvasContainer = document.getElementById('canvas-container');
        const canvas = document.getElementById('main-canvas');
        const formStates = document.querySelectorAll('.form-state'); // All form wrappers
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const forgotForm = document.getElementById('forgot-form'); // New form
        const loadingOverlay = document.getElementById('loading-overlay');
        
        // 2D Models
        const mobile2DContainer = document.getElementById('mobile-2d-container');
        const clock2DContainer = document.getElementById('clock-2d-container');
        const mobile2D = document.getElementById('mobile-2d');
        const clock2D = document.getElementById('clock-2d');
        
        // 2D Clock Hands
        const hourHand = document.getElementById('hour-hand');
        const minuteHand = document.getElementById('minute-hand');
        const secondHand = document.getElementById('second-hand');
        
        // 2D Pupils
        const pupils = document.querySelectorAll('[data-pupil="true"]');
        
        // Form Elements
        const regPassword = document.getElementById('reg-password');
        const regConfirmPasswordWrapper = document.getElementById('reg-password-confirm-wrapper');
        const regConfirmPassword = document.getElementById('reg-password-confirm');
        const regErrorMessage = document.getElementById('reg-error-message');
        const registerButton = document.getElementById('register-button');
        const googleLoginBtn = document.getElementById('login-google-btn');
        const googleRegisterBtn = document.getElementById('register-google-btn');
        const forgotPasswordLink = document.getElementById('forgot-password-link');
        const sendResetLinkButton = document.getElementById('send-reset-link'); // New button
        const formAlert = document.getElementById('form-alert-message');
        const showLoginFromReg = document.getElementById('show-login-from-reg');
        const showLoginFromForgot = document.getElementById('show-login-from-forgot'); // New link

        // --- Firebase Globals ---
        let app, auth, provider;
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        
        /**
         * Converts latitude and longitude to a 3D vector.
         */
        function latLonToVector3(lat, lon, radius) {
            const latRad = lat * (Math.PI / 180);
            const lonRad = -lon * (Math.PI / 180); // Invert longitude
            
            return new THREE.Vector3(
                Math.cos(latRad) * Math.cos(lonRad) * radius,
                Math.sin(latRad) * radius,
                Math.cos(latRad) * Math.sin(lonRad) * radius
            );
        }

        // --- 3D Initialization (Omitted for brevity, kept only essential parts) ---
        async function initThree() {
            loadingOverlay.classList.remove('hidden');
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, canvasContainer.clientWidth / canvasContainer.clientHeight, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true, alpha: true });
            renderer.setSize(canvasContainer.clientWidth, canvasContainer.clientHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setClearColor(0x000000, 0); 

            const ambientLight = new THREE.AmbientLight(0xffffff, 0.7);
            scene.add(ambientLight);
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1.0);
            directionalLight.position.set(5, 10, 7.5);
            scene.add(directionalLight);

            controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.enableZoom = true; 
            controls.enablePan = true;
            controls.enabled = false; 
            
            create3DGlobe();
            scene.add(globe);
            globe.visible = false; 
            
            // --- Calculate Camera Positions & Globe Rotations ---
            phonePositionOnGlobe = latLonToVector3(globeOriginCoords.lat, globeOriginCoords.lon, GLOBE_RADIUS);
            clockPositionOnGlobe = latLonToVector3(newYorkCoords.lat, newYorkCoords.lon, GLOBE_RADIUS);

            clockTargetQuaternion = new THREE.Quaternion().setFromUnitVectors(
                new THREE.Vector3(0, 0, 1), 
                clockPositionOnGlobe.clone().normalize()
            ).invert();
            
            phoneTargetQuaternion = new THREE.Quaternion().setFromUnitVectors(
                new THREE.Vector3(0, 0, 1),
                phonePositionOnGlobe.clone().normalize()
            ).invert();

            const phoneNormal = phonePositionOnGlobe.clone().normalize();
            phoneCamPos = phonePositionOnGlobe.clone().add(phoneNormal.multiplyScalar(5));
            phoneCamTarget = phonePositionOnGlobe.clone();
            
            const clockNormal = clockPositionOnGlobe.clone().normalize();
            clockCamPos = clockPositionOnGlobe.clone().add(clockNormal.multiplyScalar(5));
            clockCamTarget = clockPositionOnGlobe.clone();
            
            loadingOverlay.classList.add('hidden');
            animate3D(); 
        }

        /**
         * Creates the 3D Globe.
         */
        function create3DGlobe() {
            const globeGeom = new THREE.SphereGeometry(GLOBE_RADIUS, 64, 64);
            const textureLoader = new THREE.TextureLoader();
            const earthTexture = textureLoader.load('https://threejs.org/examples/textures/planets/earth_atmos_2048.jpg');
            const earthBump = textureLoader.load('https://threejs.org/examples/textures/planets/earth_bump_2048.jpg');
            const earthSpec = textureLoader.load('https://threejs.org/examples/textures/planets/earth_specular_2048.jpg');
            const globeMat = new THREE.MeshPhongMaterial({ map: earthTexture, bumpMap: earthBump, bumpScale: 0.05, specularMap: earthSpec, specular: 0x505050 });
            globe = new THREE.Mesh(globeGeom, globeMat);
            globe.name = 'Globe';
            
            const oceanGeom = new THREE.SphereGeometry(GLOBE_RADIUS - 0.5, 64, 64);
            const oceanMat = new THREE.MeshPhongMaterial({ color: 0x0077be, transparent: true, opacity: 0.8 });
            const oceanPlane = new THREE.Mesh(oceanGeom, oceanMat);
            globe.add(oceanPlane);
        }

        /**
         * Initializes Firebase App and Auth
         */
        async function initFirebase() {
            try {
                // Initialize Firebase
                app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                provider = new GoogleAuthProvider(); 
                
                // Sign in logic
                const token = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : '';
                if (token) {
                    await signInWithCustomToken(auth, token);
                } else {
                    await signInAnonymously(auth);
                }

                // Authentication state listener
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        console.log('User is signed in:', user.uid);
                    } else {
                        console.log('User is signed out.');
                    }
                });

            } catch (error) {
                console.error("Firebase initialization error:", error);
            }
        }

        /**
         * Triggers Google Sign-In Popup
         */
        async function signInWithGoogle() {
            if (!auth || !provider) {
                console.error("Firebase not initialized yet.");
                return;
            }
            try {
                const result = await signInWithPopup(auth, provider);
                const user = result.user;
                console.log("Google Sign-In Success:", user);
                showFormAlert("Successfully signed in as " + user.displayName);
            } catch (error) {
                console.error("Google Sign-In Error:", error.code, error.message);
            }
        }

        /**
         * Updates the real-time 2D clock hands
         */
        function updateClock2D() {
            const now = new Date();
            const seconds = now.getSeconds();
            const minutes = now.getMinutes();
            const hours = now.getHours();
            
            const secondsDeg = (seconds / 60) * 360;
            const minutesDeg = (minutes / 60) * 360 + (seconds / 60) * 6;
            const hoursDeg = (hours / 12) * 360 + (minutes / 60) * 30;
            
            if (secondHand) secondHand.style.transform = `rotate(${secondsDeg}deg)`;
            if (minuteHand) minuteHand.style.transform = `rotate(${minutesDeg}deg)`;
            if (hourHand) hourHand.style.transform = `rotate(${hoursDeg}deg)`;
        }

        /**
         * Main 3D animation loop. (Kept for completeness)
         */
        function animate3D() {
            requestAnimationFrame(animate3D);

            if (transitionState === 'zoomOutToGlobe') {
                camera.position.lerp(wideGlobeCamPos, 0.05);
                controls.target.lerp(globeCenter, 0.05);
                // Rotate to clock or phone based on destination
                const targetQuaternion = (currentScene === 'register') ? clockTargetQuaternion : phoneTargetQuaternion;
                globe.quaternion.slerp(targetQuaternion, 0.05); 
                
                if (camera.position.distanceTo(wideGlobeCamPos) < 1) {
                    transitionState = (currentScene === 'register') ? 'zoomInToClock' : 'zoomInToPhone';
                }
            } else if (transitionState === 'zoomInToClock') {
                camera.position.lerp(clockCamPos, 0.05);
                controls.target.lerp(clockCamTarget, 0.05);
                globe.quaternion.slerp(clockTargetQuaternion, 0.05);
                
                if (camera.position.distanceTo(clockCamPos) < 1) {
                    transitionState = 'idle';
                    canvas.style.opacity = 0;
                    clock2DContainer.classList.remove('hidden');
                    controls.enabled = false;
                }
            } else if (transitionState === 'zoomOutFromClock') {
                camera.position.lerp(wideGlobeCamPos, 0.05);
                controls.target.lerp(globeCenter, 0.05);
                // Spin to phone
                globe.quaternion.slerp(phoneTargetQuaternion, 0.05); 

                if (camera.position.distanceTo(wideGlobeCamPos) < 1) {
                    transitionState = 'zoomInToPhone';
                }
            } else if (transitionState === 'zoomInToPhone') {
                camera.position.lerp(phoneCamPos, 0.05);
                controls.target.lerp(phoneCamTarget, 0.05);
                globe.quaternion.slerp(phoneTargetQuaternion, 0.05);

                if (camera.position.distanceTo(phoneCamPos) < 1) {
                    transitionState = 'idle';
                    canvas.style.opacity = 0;
                    mobile2DContainer.classList.remove('hidden');
                    controls.enabled = false;
                }
            }
            // Add a simple rotation if idle and 3D is visible
            if (transitionState === 'idle' && globe.visible) {
                 globe.rotation.y += 0.001; 
            }

            if (renderer) renderer.render(scene, camera);
            if (controls) controls.update();
        }
        
        /**
         * Main 2D animation loop for eyes
         */
        function animate2D() {
            const maxPupilMove = 8; 

            // Determine which 2D model is active
            let activeContainer;
            if (mobile2DContainer.classList.contains('hidden')) {
                activeContainer = clock2D;
            } else {
                activeContainer = mobile2D;
            }

            let activePupils = activeContainer.querySelectorAll('[data-pupil="true"]');

            if (isPeekingPassword) {
                // Peeking overrides mouse tracking
                activeContainer.classList.add('peeking');
                activePupils.forEach(pupil => {
                    pupil.style.transform = 'translate(-50%, -50%) scale(0)';
                });
            } else {
                // Not peeking, track input/mouse/touch
                activeContainer.classList.remove('peeking');
                
                const eyeContainer = activeContainer.querySelector('.face');
                if (!eyeContainer) {
                    requestAnimationFrame(animate2D);
                    return; 
                }
                
                // Get center of the eye container
                const rect = eyeContainer.getBoundingClientRect();
                const containerCenterX = rect.left + rect.width / 2;
                const containerCenterY = rect.top + rect.height / 2;

                // Get vector from center to mouse/touch point
                const deltaX = mousePixel.x - containerCenterX;
                const deltaY = mousePixel.y - containerCenterY;
                
                // Get angle
                const angle = Math.atan2(deltaY, deltaX);
                
                // Calculate position based on angle and max distance
                let moveX = Math.cos(angle) * maxPupilMove;
                let moveY = Math.sin(angle) * maxPupilMove;

                // Apply transform
                activePupils.forEach(pupil => {
                    pupil.style.transform = `translate(calc(-50% + ${moveX}px), calc(-50% + ${moveY}px)) scale(1)`;
                });
            }

            requestAnimationFrame(animate2D);
        }


        /**
         * Initializes all DOM event listeners.
         */
        function initEventListeners() {
            // Mouse/Touch Tracking for Eyes
            window.addEventListener('mousemove', onMove);
            window.addEventListener('touchstart', onTouchStart, { passive: false });
            window.addEventListener('touchmove', onMove, { passive: false });
            window.addEventListener('touchend', onTouchEnd);
            
            window.addEventListener('resize', onWindowResize);

            // Form Transitions
            document.getElementById('show-register').addEventListener('click', () => startTransition('register'));
            showLoginFromReg.addEventListener('click', () => startTransition('login'));
            forgotPasswordLink.addEventListener('click', (e) => {
                e.preventDefault();
                startTransition('forgot'); // Show forgot form
            });
            showLoginFromForgot.addEventListener('click', () => startTransition('login')); // Back to login

            const inputs = document.querySelectorAll('.form-input');
            inputs.forEach(input => {
                input.addEventListener('focus', () => { isWatchingInput = true; isPeekingPassword = false; });
                input.addEventListener('blur', () => { isWatchingInput = false; isPeekingPassword = false; });
            });
            
            // Register form logic
            registerButton.addEventListener('click', handleRegister);
            regPassword.addEventListener('keyup', (e) => {
                if (regPassword.value.length > 0 && regConfirmPasswordWrapper.classList.contains('hidden')) {
                    regConfirmPasswordWrapper.classList.remove('hidden');
                }
                if (e.key === 'Enter') handleRegister();
            });
            regConfirmPassword.addEventListener('keyup', (e) => {
                if (e.key === 'Enter') handleRegister();
            });
            
            // Forgot Password logic
            sendResetLinkButton.addEventListener('click', handleForgotPassword);

            googleLoginBtn.addEventListener('click', signInWithGoogle);
            googleRegisterBtn.addEventListener('click', signInWithGoogle);

            document.getElementById('login-button').addEventListener('click', () => {
                showFormAlert("Login Attempted (Mock)");
            });
        }
        
        /**
         * Shows a message in the alert box
         */
        function showFormAlert(message) {
            formAlert.textContent = message;
            formAlert.style.display = 'block';
            setTimeout(() => {
                formAlert.style.display = 'none';
            }, 5000);
        }
        
        /**
         * Handle Register button click
         */
        function handleRegister() {
            // Mock registration validation
            if (regConfirmPasswordWrapper.classList.contains('hidden')) {
                regConfirmPasswordWrapper.classList.remove('hidden');
                regErrorMessage.classList.add('hidden');
                return;
            }
            
            const pass = regPassword.value;
            const confirmPass = regConfirmPassword.value;
            
            if (pass !== confirmPass) {
                regErrorMessage.textContent = "Passwords do not match.";
                regErrorMessage.classList.remove('hidden');
            } else if (pass.length < 6) {
                regErrorMessage.textContent = "Password must be at least 6 characters long.";
                regErrorMessage.classList.remove('hidden');
            } else {
                regErrorMessage.classList.add('hidden');
                console.log("Registration successful (mock)");
                showFormAlert("Account created successfully! (Mock)");
            }
        }
        
        /**
         * Handle Forgot Password button click (NEW FUNCTION)
         */
        function handleForgotPassword() {
            const email = document.getElementById('forgot-email').value;
            if (!email || !email.includes('@')) {
                showFormAlert("Please enter a valid email address.");
                return;
            }
            showFormAlert(`Password reset link (mock) sent to: ${email}`);
            document.getElementById('forgot-email').value = ''; // Clear input
        }


        /**
         * Starts the scene transition and swaps forms.
         */
        function startTransition(targetScene) {
            if (transitionState !== 'idle' || currentScene === targetScene) return;

            formAlert.style.display = 'none';
            regErrorMessage.classList.add('hidden');
            
            const prevScene = currentScene;
            currentScene = targetScene;

            // 1. Hide the previous 2D model (if coming from login/register, which uses the phone)
            // or hide the 3D globe (if transitioning between forms using the same 2D model)

            if (prevScene === 'login' && targetScene === 'register') {
                // Login (Phone) -> Register (Clock) transition
                mobile2DContainer.classList.add('hidden');
                canvas.style.opacity = 1;
                globe.visible = true;
                controls.enabled = true;
                transitionState = 'zoomOutToGlobe'; // Use the 3D transition for this swap
            } else if (prevScene === 'register' && targetScene === 'login') {
                // Register (Clock) -> Login (Phone) transition
                clock2DContainer.classList.add('hidden');
                canvas.style.opacity = 1;
                globe.visible = true;
                controls.enabled = true;
                transitionState = 'zoomOutFromClock'; // Use the 3D transition for this swap
            } else if (targetScene === 'forgot' || prevScene === 'forgot') {
                // Transition between login <-> forgot (No 3D transition needed, keep phone visible)
                // We rely on the 2D logic to switch to the phone if needed
                if (clock2DContainer.classList.contains('hidden')) {
                    mobile2DContainer.classList.remove('hidden');
                }
            }


            // 2. Swap Forms
            formStates.forEach(form => {
                if (form.getAttribute('data-form-state') === targetScene) {
                    form.classList.add('active');
                } else {
                    form.classList.remove('active');
                }
            });
            
            // 3. Reset Eye State
            isPeekingPassword = false;
            isWatchingInput = false;
        }

        // --- Event Handlers ---
        
        /**
         * Handles mousemove and touchmove events
         */
        function onMove(event) {
            let clientX, clientY;
            
            if (event.touches && event.touches.length > 0) {
                // Handle touch event
                clientX = event.touches[0].clientX;
                clientY = event.touches[0].clientY;
                // REMOVED event.preventDefault() here to allow button clicks/taps to register
            } else {
                // Handle mouse event
                clientX = event.clientX;
                clientY = event.clientY;
            }

            // Update pixel mouse for 2D tracking
            mousePixel.x = clientX;
            mousePixel.y = clientY;
            
            // Update normalized mouse for 3D tracking
            if (clientX < (window.innerWidth / 2) || window.innerWidth < 1024) {
                mouse.x = (clientX / (window.innerWidth / 2)) * 2 - 1;
                mouse.y = -(clientY / window.innerHeight) * 2 + 1;
            } else {
                mouse.x = 0; mouse.y = 0;
            }
        }
        
        /**
         * Initializes mousePixel on touch start
         */
        function onTouchStart(event) {
            if (event.touches && event.touches.length > 0) {
                mousePixel.x = event.touches[0].clientX;
                mousePixel.y = event.touches[0].clientY;
            }
            onMove(event); // Process the first touch location
        }

        /**
         * Clears mousePixel on touch end
         */
        function onTouchEnd() {
            // When touch ends, reset the mousePixel to a neutral spot (or keep last position)
            // Keeping last position provides a smooth feel. We can also reset to center if preferred.
            // For now, let's keep the last position until a new move/touch occurs.
        }

        function onWindowResize() {
            const containerWidth = canvasContainer.clientWidth;
            const containerHeight = canvasContainer.clientHeight;
            camera.aspect = containerWidth / containerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(containerWidth, containerHeight);
        }

        window.togglePasswordVisibility = function(button) {
            const wrapper = button.parentElement;
            const input = wrapper.querySelector('input');
            const eyeIcon = wrapper.querySelector('.eye-icon');
            const eyeOffIcon = wrapper.querySelector('.eye-off-icon');

            if (input.type === 'password') {
                input.type = 'text';
                eyeIcon.classList.add('hidden');
                eyeOffIcon.classList.remove('hidden');
                isPeekingPassword = true;
            } else {
                input.type = 'password';
                eyeIcon.classList.remove('hidden');
                eyeOffIcon.classList.add('hidden');
                isPeekingPassword = false;
            }
        }

        // --- Start Application ---
        await initFirebase();
        await initThree();
        initEventListeners();
        animate2D();
        setInterval(updateClock2D, 1000);

    </script>
</body>
</html>